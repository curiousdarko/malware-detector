import winreg
import time
import sys

sys.stdout.write("\x1b]2;Registry Monitor\x07")

# Define the registry key you want to monitor
key_path = r"SOFTWARE\Microsoft\Windows\CurrentVersion\Run"

# Open the registry key and get a handle to it
key = winreg.OpenKey(winreg.HKEY_CURRENT_USER, key_path, 0, winreg.KEY_NOTIFY)

# Set up the registry change notification
winreg.NotifyChangeKeyValue(key, True, winreg.REG_NOTIFY_CHANGE_LAST_SET)

try:
    while True:
        # Wait for the registry key to change
        result = winreg.WaitForSingleObject(key.handle, 5000)

        # If the key has changed, print the new value
        if result == winreg.WAIT_OBJECT_0:
            value, type = winreg.QueryValueEx(key, "Python Registry Monitor")
            print(f"New value: {value}")

            # Reset the registry change notification
            winreg.NotifyChangeKeyValue(key, True, winreg.REG_NOTIFY_CHANGE_LAST_SET)
        else:
            print("Waiting for registry change...")

except KeyboardInterrupt:
    pass

# Close the registry key handle
winreg.CloseKey(key)
